<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Quad - Ask & Answer - Avocado</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="header-container">
      <a href="../index.html" class="logo-section" style="text-decoration: none;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
          <path fill="#795548" d="M28,10c-0.6,0-1-0.4-1-1c0-3.4,2.2-5.6,2.3-5.7c0.4-0.4,1-0.4,1.4,0c0.4,0.4,0.4,1,0,1.4 c0,0-1.7,1.8-1.7,4.3C29,9.6,28.6,10,28,10z"/>
          <path fill="#558b2f" d="M25.1,7C17.5,7,10,20.4,10,32c0,8,6.4,13,14,13s14-5,14-13c0-9.5-5.6-11.3-5.6-20.8 C32.4,8.7,30,8,28,8C27.2,8,27,7,25.1,7z"/>
          <path fill="#dce775" d="M33.4,22.5c-1.4-2.8-3-6.1-3-11.3c0-1.1-1.9-1.2-2.4-1.2c-0.9,0-1.6-0.4-1.9-0.7 c-0.3-0.2-0.4-0.3-1-0.3C19,9,12,21.3,12,32c0,7.2,6,11,12,11s12-3.8,12-11C36,27.7,34.8,25.2,33.4,22.5z"/>
          <path fill="#fff59d" d="M15,33c0-5,4-16,9-16s9,11,9,16s-4,9-9,9S15,38,15,33z"/>
          <path fill="#962005" d="M30,33c0,3.3-2.7,6-6,6s-6-2.7-6-6s2.7-10,6-10S30,29.7,30,33z"/>
          <path fill="#bf360c" d="M24,23c-3.3,0-6,6.7-6,10c0,0.4,0,0.7,0.1,1.1C19,35.3,20.4,36,22,36c4,0,6-2.2,6-5 c0-3.9-0.8-6-1.9-7.1C25.4,23.3,24.7,23,24,23z"/>
        </svg>
        <span>AVOCADO</span>
      </a>
      
      <nav>
        <a href="../index.html">HOME</a>
        <a href="marketplace.html">MARKETPLACE</a>
        <a href="quad.html" class="active">THE QUAD</a>
        <a href="dorm-alerts.html">ALERTS</a>
        <a href="messages.html">MESSAGES</a>
      </nav>

      <div class="user-section">
        <div class="cart-icon" onclick="openNotifications()">
          ðŸ””
          <span class="cart-count" id="notification-count">0</span>
        </div>
        <div class="user-profile" id="user-profile-btn" onclick="openUserMenu()">
          <span id="user-initial">A</span>
        </div>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="hero-content">
      <h1>The Quad</h1>
      <p>Ask Questions Anonymously â€¢ Get Answers from Fellow Students</p>
      <button class="btn btn-primary btn-lg" style="margin-top: 20px;" onclick="openPostQuestionModal()">
        + Ask a Question
      </button>
    </div>
  </section>

  <!-- FILTER BAR -->
  <div class="filter-bar">
    <div class="filter-buttons">
      <button class="filter-btn active" onclick="filterQuestions('all')">All Questions</button>
      <button class="filter-btn" onclick="filterQuestions('unanswered')">Unanswered</button>
      <button class="filter-btn" onclick="filterQuestions('my')">My Questions</button>
    </div>
    <select class="sort-dropdown" id="sort-dropdown" onchange="sortQuestions()">
      <option value="">Recent</option>
      <option value="popular">Most Popular</option>
      <option value="trending">Trending</option>
      <option value="unanswered">Unanswered</option>
    </select>
  </div>

  <!-- QUESTIONS FEED -->
  <div class="container" style="max-width: 900px;">
    <div style="background-color: white; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);">
      <div id="questions-feed" style="min-height: 400px;">
        <!-- Questions loaded by JavaScript -->
      </div>
    </div>
  </div>


  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>ABOUT AVOCADO</h3>
        <p style="font-size: 14px; color: #ccc; margin-bottom: 12px;">Your university's ultimate marketplace and community platform.</p>
      </div>
      <div class="footer-section">
        <h3>COMMUNITY</h3>
        <a href="#">The Quad</a>
        <a href="#">Dorm Alerts</a>
        <a href="#">Messages</a>
        <a href="#">Events</a>
      </div>
      <div class="footer-section">
        <h3>SUPPORT</h3>
        <a href="#">Help Center</a>
        <a href="#">Report Issue</a>
        <a href="#">Contact</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Avocado. All rights reserved.</p>
    </div>
  </footer>

  <!-- POST QUESTION MODAL -->
  <div class="modal" id="post-question-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Ask a Question</h2>
        <button class="modal-close" onclick="closePostQuestionModal()">&times;</button>
      </div>
      <form onsubmit="handlePostQuestion(event)">
        <div class="form-group">
          <label for="question-title">Question Title</label>
          <input type="text" id="question-title" placeholder="What's your question?" required>
        </div>
        <div class="form-group">
          <label for="question-content">Details (Optional)</label>
          <textarea id="question-content" placeholder="Provide more context..."></textarea>
        </div>
        <div class="form-group">
          <label for="question-tags">Tags (comma-separated)</label>
          <input type="text" id="question-tags" placeholder="e.g., dorm, textbooks, events">
        </div>
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <input type="checkbox" id="question-anonymous" checked>
          <label for="question-anonymous" style="margin: 0;">Post anonymously</label>
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Post Question</button>
      </form>
    </div>
  </div>

  <!-- ANSWER MODAL -->
  <div class="modal" id="answer-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Your Answer</h2>
        <button class="modal-close" onclick="closeAnswerModal()">&times;</button>
      </div>
      <form onsubmit="handlePostAnswer(event)">
        <div class="form-group">
          <label for="answer-content">Your Answer</label>
          <textarea id="answer-content" placeholder="Help answer the question..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Post Answer</button>
      </form>
    </div>
  </div>

  <div class="modal" id="user-menu-modal">
    <div class="modal-content" style="max-width: 350px; margin-top: -200px;">
      <div class="modal-header">
        <h2 class="modal-title">Account</h2>
        <button class="modal-close" onclick="closeUserMenu()">&times;</button>
      </div>
      <div id="user-menu-content"></div>
    </div>
  </div>

  <div class="modal" id="login-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Sign In</h2>
        <button class="modal-close" onclick="closeLoginModal()">&times;</button>
      </div>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" required>
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" required>
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Sign In</button>
      </form>
    </div>
  </div>

  <script src="../js/auth.js"></script>
  <script src="../js/marketplace.js"></script>
  <script src="../js/main.js"></script>
  <script>
    // Sample questions data
    const defaultQuestions = [
      {
        id: 1,
        title: "Best place to study on campus?",
        content: "I need a quiet place to study for exams. Any suggestions?",
        author: "Anonymous Student",
        is_anonymous: true,
        tags: ["campus", "study"],
        posted_date: "2024-01-25",
        views: 245,
        answers: 8,
        upvotes: 34
      },
      {
        id: 2,
        title: "Textbook for CS 101?",
        content: "Is there a cheaper alternative to the official CS 101 textbook?",
        author: "Anonymous Student",
        is_anonymous: true,
        tags: ["textbooks", "cs"],
        posted_date: "2024-01-24",
        views: 156,
        answers: 12,
        upvotes: 28
      },
      {
        id: 3,
        title: "Dorm WiFi problems - how to fix?",
        content: "My wifi keeps dropping in my dorm. Anyone else experiencing this?",
        author: "Anonymous Student",
        is_anonymous: true,
        tags: ["dorm", "tech"],
        posted_date: "2024-01-23",
        views: 89,
        answers: 5,
        upvotes: 12
      }
    ];

    let questions = JSON.parse(localStorage.getItem('avocado_questions')) || defaultQuestions;
    let currentQuestionFilter = 'all';

    function renderQuestions(questionsToRender = questions) {
      const feed = document.getElementById('questions-feed');
      if (!feed) return;

      if (questionsToRender.length === 0) {
        feed.innerHTML = '<p class="text-center" style="padding: 40px;">No questions found</p>';
        return;
      }

      feed.innerHTML = questionsToRender.map(q => `
        <div style="padding: 20px; border-bottom: 1px solid #e0d5cc; cursor: pointer;" onclick="viewQuestion(${q.id})">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
              <h3 style="margin-bottom: 8px; color: #333;">${q.title}</h3>
              <p style="color: #666; font-size: 14px; margin-bottom: 12px;">${q.content.substring(0, 100)}...</p>
              <div style="display: flex; gap: 16px; font-size: 12px; color: #999;">
                <span>By ${q.author}</span>
                <span>${formatDate(q.posted_date)}</span>
                <span>${q.tags.join(', ')}</span>
              </div>
            </div>
            <div style="text-align: right; margin-left: 20px;">
              <div style="font-size: 20px; font-weight: 700; color: #558b2f;">${q.answers}</div>
              <div style="font-size: 12px; color: #999;">answers</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function openPostQuestionModal() {
      if (!currentUser) {
        openLoginModal();
        return;
      }
      document.getElementById('post-question-modal').classList.add('active');
    }

    function closePostQuestionModal() {
      document.getElementById('post-question-modal').classList.remove('active');
    }

    function handlePostQuestion(event) {
      event.preventDefault();

      if (!currentUser) {
        showAlert('error', 'Please sign in first');
        return;
      }

      const isAnonymous = document.getElementById('question-anonymous').checked;

      const newQuestion = {
        id: Date.now(),
        title: document.getElementById('question-title').value,
        content: document.getElementById('question-content').value,
        author: isAnonymous ? "Anonymous Student" : currentUser.name,
        author_id: currentUser.id,
        is_anonymous: isAnonymous,
        tags: document.getElementById('question-tags').value.split(',').map(t => t.trim()).filter(t => t),
        posted_date: new Date().toISOString(),
        views: 0,
        answers: 0,
        upvotes: 0
      };

      questions.push(newQuestion);
      localStorage.setItem('avocado_questions', JSON.stringify(questions));

      showAlert('success', 'Question posted successfully!');
      closePostQuestionModal();
      renderQuestions();
    }

    function filterQuestions(filter) {
      currentQuestionFilter = filter;

      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');

      let filtered = questions;

      if (filter === 'unanswered') {
        filtered = filtered.filter(q => q.answers === 0);
      } else if (filter === 'my') {
        if (!currentUser) {
          showAlert('error', 'Please sign in first');
          return;
        }
        filtered = filtered.filter(q => q.author_id === currentUser.id);
      }

      renderQuestions(filtered);
    }

    function sortQuestions() {
      const sort = document.getElementById('sort-dropdown').value;
      let sorted = [...questions];

      switch (sort) {
        case 'popular':
          sorted.sort((a, b) => b.upvotes - a.upvotes);
          break;
        case 'trending':
          sorted.sort((a, b) => b.views - a.views);
          break;
        case 'unanswered':
          sorted = sorted.filter(q => q.answers === 0);
          break;
      }

      renderQuestions(sorted);
    }

    function viewQuestion(questionId) {
      const question = questions.find(q => q.id === questionId);
      if (!question) return;

      const modal = document.createElement('div');
      modal.className = 'modal active';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 700px;">
          <div class="modal-header">
            <h2 class="modal-title">${question.title}</h2>
            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
          </div>
          <p style="color: #666; margin-bottom: 20px;">${question.content}</p>
          <div style="padding: 12px; background-color: #f5f1ed; border-radius: 4px; margin-bottom: 20px; font-size: 12px;">
            <p>By <strong>${question.author}</strong> â€¢ ${formatDate(question.posted_date)}</p>
            <p style="color: #999; margin-top: 4px;">${question.views} views â€¢ ${question.answers} answers</p>
          </div>
          <button class="btn btn-primary btn-block btn-lg" onclick="openAnswerModalForQuestion(${question.id})">
            Post Answer
          </button>
        </div>
      `;

      document.body.appendChild(modal);
    }

    function openAnswerModalForQuestion(questionId) {
      if (!currentUser) {
        document.querySelector('.modal.active').remove();
        openLoginModal();
        return;
      }

      document.querySelector('.modal.active').remove();
      window.currentAnsweringQuestionId = questionId;
      document.getElementById('answer-modal').classList.add('active');
    }

    function closeAnswerModal() {
      document.getElementById('answer-modal').classList.remove('active');
    }

    function handlePostAnswer(event) {
      event.preventDefault();

      const question = questions.find(q => q.id === window.currentAnsweringQuestionId);
      if (!question) return;

      const answerContent = document.getElementById('answer-content').value;

      // Store answer (in production, would be in separate answers table)
      const answer = {
        id: Date.now(),
        question_id: question.id,
        author_id: currentUser.id,
        content: answerContent,
        posted_date: new Date().toISOString(),
        upvotes: 0
      };

      question.answers++;
      localStorage.setItem('avocado_questions', JSON.stringify(questions));

      showAlert('success', 'Answer posted!');
      closeAnswerModal();
      renderQuestions();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      renderQuestions();
      updateUserUI();
    });
  </script>
</body>
</html>
