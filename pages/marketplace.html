<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marketplace - Avocado</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
  <!-- ============ HEADER ============ -->
  <header>
    <div class="header-container">
      <a href="../index.html" class="logo-section" style="text-decoration: none;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
          <path fill="#795548" d="M28,10c-0.6,0-1-0.4-1-1c0-3.4,2.2-5.6,2.3-5.7c0.4-0.4,1-0.4,1.4,0c0.4,0.4,0.4,1,0,1.4 c0,0-1.7,1.8-1.7,4.3C29,9.6,28.6,10,28,10z"/>
          <path fill="#558b2f" d="M25.1,7C17.5,7,10,20.4,10,32c0,8,6.4,13,14,13s14-5,14-13c0-9.5-5.6-11.3-5.6-20.8 C32.4,8.7,30,8,28,8C27.2,8,27,7,25.1,7z"/>
          <path fill="#dce775" d="M33.4,22.5c-1.4-2.8-3-6.1-3-11.3c0-1.1-1.9-1.2-2.4-1.2c-0.9,0-1.6-0.4-1.9-0.7 c-0.3-0.2-0.4-0.3-1-0.3C19,9,12,21.3,12,32c0,7.2,6,11,12,11s12-3.8,12-11C36,27.7,34.8,25.2,33.4,22.5z"/>
          <path fill="#fff59d" d="M15,33c0-5,4-16,9-16s9,11,9,16s-4,9-9,9S15,38,15,33z"/>
          <path fill="#962005" d="M30,33c0,3.3-2.7,6-6,6s-6-2.7-6-6s2.7-10,6-10S30,29.7,30,33z"/>
          <path fill="#bf360c" d="M24,23c-3.3,0-6,6.7-6,10c0,0.4,0,0.7,0.1,1.1C19,35.3,20.4,36,22,36c4,0,6-2.2,6-5 c0-3.9-0.8-6-1.9-7.1C25.4,23.3,24.7,23,24,23z"/>
        </svg>
        <span>AVOCADO</span>
      </a>
      
      <nav>
        <a href="../index.html">HOME</a>
        <a href="marketplace.html" class="active">MARKETPLACE</a>
        <a href="quad.html">THE QUAD</a>
        <a href="dorm-alerts.html">ALERTS</a>
        <a href="messages.html">MESSAGES</a>
      </nav>

      <div class="user-section">
        <div class="cart-icon" onclick="openNotifications()">
          ðŸ””
          <span class="cart-count" id="notification-count">0</span>
        </div>
        <div class="user-profile" id="user-profile-btn" onclick="openUserMenu()">
          <span id="user-initial">A</span>
        </div>
      </div>
    </div>
  </header>

  <!-- ============ PAGE CONTENT ============ -->
  <section class="hero" style="padding: 40px 16px;">
    <div class="hero-content">
      <h1>Marketplace</h1>
      <p>Buy, Sell, Rent, and Donate with Fellow Students</p>
      <button class="btn btn-primary btn-lg" style="margin-top: 20px;" onclick="openPostItemModal()">
        + Post New Item
      </button>
    </div>
  </section>

  <!-- ============ FILTER BAR ============ -->
  <div class="filter-bar">
    <div class="filter-buttons">
      <button class="filter-btn active" onclick="filterProducts('all')">All Products</button>
      <button class="filter-btn" onclick="filterProducts('buy')">Buy</button>
      <button class="filter-btn" onclick="filterProducts('sell')">Sell</button>
      <button class="filter-btn" onclick="filterProducts('rent')">Rent</button>
      <button class="filter-btn" onclick="filterProducts('free')">Free</button>
    </div>
    <select class="sort-dropdown" id="sort-dropdown" onchange="sortProducts()">
      <option value="">Default Sorting</option>
      <option value="price-low">Price: Low to High</option>
      <option value="price-high">Price: High to Low</option>
      <option value="newest">Newest First</option>
      <option value="popular">Most Popular</option>
    </select>
  </div>

  <!-- PRODUCTS GRID -->
  <div class="container">
    <div class="grid" id="products-grid">
      <!-- Products loaded by JavaScript -->
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>ABOUT AVOCADO</h3>
        <p style="font-size: 14px; color: #ccc; margin-bottom: 12px;">Your university's ultimate marketplace and community platform.</p>
      </div>
      <div class="footer-section">
        <h3>MARKETPLACE</h3>
        <a href="#">Buy</a>
        <a href="#">Sell</a>
        <a href="#">Rent</a>
        <a href="#">Donate</a>
      </div>
      <div class="footer-section">
        <h3>COMMUNITY</h3>
        <a href="quad.html">The Quad</a>
        <a href="dorm-alerts.html">Dorm Alerts</a>
        <a href="messages.html">Messages</a>
      </div>
      <div class="footer-section">
        <h3>SUPPORT</h3>
        <a href="#">Help Center</a>
        <a href="#">Report Issue</a>
        <a href="#">Contact</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Avocado. All rights reserved.</p>
    </div>
  </footer>

  <!-- POST ITEM MODAL -->
  <div class="modal" id="post-item-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Post New Item</h2>
        <button class="modal-close" onclick="closePostItemModal()">&times;</button>
      </div>
      <form onsubmit="handlePostItem(event)">
        <div class="form-group">
          <label for="item-type">Item Type</label>
          <select id="item-type" required onchange="updateItemTypeHelp()">
            <option value="">Select Type...</option>
            <option value="buy">Item for Sale</option>
            <option value="sell">Buying Request</option>
            <option value="rent">Available for Rent</option>
            <option value="free">Free Item (Donation)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="item-title">Title</label>
          <input type="text" id="item-title" placeholder="e.g., Laptop Stand - Adjustable" required>
        </div>
        <div class="form-group">
          <label for="item-description">Description</label>
          <textarea id="item-description" placeholder="Describe the item, condition, etc." required></textarea>
        </div>
        <div class="form-group">
          <label for="item-category">Category</label>
          <select id="item-category" required>
            <option value="">Select Category...</option>
            <option value="electronics">Electronics</option>
            <option value="furniture">Furniture</option>
            <option value="textbooks">Textbooks</option>
            <option value="sports">Sports & Equipment</option>
            <option value="clothing">Clothing</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="item-dorm">Dorm/Building</label>
          <input type="text" id="item-dorm" placeholder="e.g., Dorm I" required>
        </div>
        <div class="form-group">
          <label for="item-condition">Condition</label>
          <select id="item-condition" required>
            <option value="">Select Condition...</option>
            <option value="Like New">Like New</option>
            <option value="Good">Good</option>
            <option value="Fair">Fair</option>
            <option value="Used">Used</option>
          </select>
        </div>
        <div id="price-group" class="form-group">
          <label for="item-price">Price ($)</label>
          <input type="number" id="item-price" min="0" step="0.01" placeholder="0.00" required>
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Post Item</button>
      </form>
    </div>
  </div>

  <!-- USER MENU MODAL -->
  <div class="modal" id="user-menu-modal">
    <div class="modal-content" style="max-width: 350px; margin-top: -200px;">
      <div class="modal-header">
        <h2 class="modal-title">Account</h2>
        <button class="modal-close" onclick="closeUserMenu()">&times;</button>
      </div>
      <div id="user-menu-content">
        <!-- Populated by auth.js -->
      </div>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div class="modal" id="login-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Sign In</h2>
        <button class="modal-close" onclick="closeLoginModal()">&times;</button>
      </div>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" required>
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" required>
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Sign In</button>
      </form>
    </div>
  </div>

  <!-- REGISTER MODAL -->
  <div class="modal" id="register-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Create Account</h2>
        <button class="modal-close" onclick="closeRegisterModal()">&times;</button>
      </div>
      <form onsubmit="handleRegister(event)">
        <div class="form-group">
          <label for="reg-name">Full Name</label>
          <input type="text" id="reg-name" required>
        </div>
        <div class="form-group">
          <label for="reg-email">Personal Email</label>
          <input type="email" id="reg-email" required>
        </div>
        <div class="form-group">
          <label for="reg-uni-email">University Email (.edu)</label>
          <input type="email" id="reg-uni-email" placeholder="user@university.edu" required>
        </div>
        <div class="form-group">
          <label for="reg-password">Password</label>
          <input type="password" id="reg-password" required>
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Register</button>
      </form>
    </div>
  </div>

  <script src="../js/auth.js"></script>
  <script src="../js/marketplace.js"></script>
  <script src="../js/main.js"></script>
  <script>
    function openPostItemModal() {
      if (!currentUser) {
        openLoginModal();
        return;
      }
      document.getElementById('post-item-modal').classList.add('active');
    }

    function closePostItemModal() {
      document.getElementById('post-item-modal').classList.remove('active');
    }

    function updateItemTypeHelp() {
      const type = document.getElementById('item-type').value;
      const priceGroup = document.getElementById('price-group');
      
      if (type === 'free') {
        priceGroup.style.display = 'none';
        document.getElementById('item-price').value = '0';
      } else {
        priceGroup.style.display = 'block';
      }
    }

    function handlePostItem(event) {
      event.preventDefault();

      if (!currentUser) {
        showAlert('error', 'Please sign in first');
        return;
      }

      const newItem = {
        id: Date.now(),
        title: document.getElementById('item-title').value,
        category: document.getElementById('item-type').value,
        price: parseFloat(document.getElementById('item-price').value) || 0,
        seller: currentUser.name,
        seller_id: currentUser.id,
        image: 'ðŸ“¦',
        description: document.getElementById('item-description').value,
        condition: document.getElementById('item-condition').value,
        dorm: document.getElementById('item-dorm').value,
        posted_date: new Date().toISOString(),
        views: 0
      };

      products.push(newItem);
      localStorage.setItem('avocado_products', JSON.stringify(products));

      showAlert('success', 'Item posted successfully!');
      closePostItemModal();
      renderProducts();
    }
  </script>
</body>
</html>
