<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dorm Alerts - Avocado</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
  
  <header>
    <div class="header-container">
      <a href="../index.html" class="logo-section" style="text-decoration: none;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
          <path fill="#795548" d="M28,10c-0.6,0-1-0.4-1-1c0-3.4,2.2-5.6,2.3-5.7c0.4-0.4,1-0.4,1.4,0c0.4,0.4,0.4,1,0,1.4 c0,0-1.7,1.8-1.7,4.3C29,9.6,28.6,10,28,10z"/>
          <path fill="#558b2f" d="M25.1,7C17.5,7,10,20.4,10,32c0,8,6.4,13,14,13s14-5,14-13c0-9.5-5.6-11.3-5.6-20.8 C32.4,8.7,30,8,28,8C27.2,8,27,7,25.1,7z"/>
          <path fill="#dce775" d="M33.4,22.5c-1.4-2.8-3-6.1-3-11.3c0-1.1-1.9-1.2-2.4-1.2c-0.9,0-1.6-0.4-1.9-0.7 c-0.3-0.2-0.4-0.3-1-0.3C19,9,12,21.3,12,32c0,7.2,6,11,12,11s12-3.8,12-11C36,27.7,34.8,25.2,33.4,22.5z"/>
          <path fill="#fff59d" d="M15,33c0-5,4-16,9-16s9,11,9,16s-4,9-9,9S15,38,15,33z"/>
          <path fill="#962005" d="M30,33c0,3.3-2.7,6-6,6s-6-2.7-6-6s2.7-10,6-10S30,29.7,30,33z"/>
          <path fill="#bf360c" d="M24,23c-3.3,0-6,6.7-6,10c0,0.4,0,0.7,0.1,1.1C19,35.3,20.4,36,22,36c4,0,6-2.2,6-5 c0-3.9-0.8-6-1.9-7.1C25.4,23.3,24.7,23,24,23z"/>
        </svg>
        <span>AVOCADO</span>
      </a>
      
      <nav>
        <a href="../index.html">HOME</a>
        <a href="marketplace.html">MARKETPLACE</a>
        <a href="quad.html">THE QUAD</a>
        <a href="dorm-alerts.html" class="active">ALERTS</a>
        <a href="messages.html">MESSAGES</a>
      </nav>

      <div class="user-section">
        <div class="cart-icon" onclick="openNotifications()">
          üîî
          <span class="cart-count" id="notification-count">0</span>
        </div>
        <div class="user-profile" id="user-profile-btn" onclick="openUserMenu()">
          <span id="user-initial">A</span>
        </div>
      </div>
    </div>
  </header>

  
  <section class="hero">
    <div class="hero-content">
      <h1>Dorm Alerts</h1>
      <p>Stay Updated with Important Announcements & Events</p>
    </div>
  </section>

  
  <div class="container" style="max-width: 900px;">
    <div style="display: grid; grid-template-columns: 1fr 300px; gap: 30px;">
      
      <div>
        <div style="background-color: white; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); overflow: hidden;">
          <div id="alerts-feed" style="min-height: 400px;">
            <!-- Alerts loaded by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <aside>
        <!-- Subscribed Dorms -->
        <div style="background-color: white; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); padding: 20px;">
          <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">Your Dorms</h3>
          <div id="dorm-subscriptions">
            <p class="text-muted">Loading...</p>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>ABOUT AVOCADO</h3>
        <p style="font-size: 14px; color: #ccc; margin-bottom: 12px;">Stay connected with your dorm community.</p>
      </div>
      <div class="footer-section">
        <h3>COMMUNITY</h3>
        <a href="quad.html">The Quad</a>
        <a href="dorm-alerts.html">Dorm Alerts</a>
        <a href="messages.html">Messages</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Avocado. All rights reserved.</p>
    </div>
  </footer>

  <div class="modal" id="user-menu-modal">
    <div class="modal-content" style="max-width: 350px; margin-top: -200px;">
      <div class="modal-header">
        <h2 class="modal-title">Account</h2>
        <button class="modal-close" onclick="closeUserMenu()">&times;</button>
      </div>
      <div id="user-menu-content"></div>
    </div>
  </div>

  <div class="modal" id="login-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Sign In</h2>
        <button class="modal-close" onclick="closeLoginModal()">&times;</button>
      </div>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" required>
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" required>
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Sign In</button>
      </form>
    </div>
  </div>

  <script src="../js/auth.js"></script>
  <script src="../js/marketplace.js"></script>
  <script src="../js/main.js"></script>
  <script>
    // Sample alerts data
    const defaultAlerts = [
      {
        id: 1,
        title: "WiFi Maintenance - Dorm I",
        content: "WiFi will be down for maintenance on January 28 from 2-4 PM",
        dorm: "Dorm I",
        type: "maintenance",
        posted_date: "2024-01-25",
        priority: "high"
      },
      {
        id: 2,
        title: "Dorm Movie Night",
        content: "Join us for a movie night in the common room! Snacks provided.",
        dorm: "Dorm II",
        type: "event",
        posted_date: "2024-01-24",
        priority: "normal"
      },
      {
        id: 3,
        title: "Fire Alarm Testing",
        content: "Fire alarm testing will occur on January 27. Please do not be alarmed.",
        dorm: "Dorm III",
        type: "alert",
        posted_date: "2024-01-23",
        priority: "high"
      },
      {
        id: 4,
        title: "Cleaning Supplies Available",
        content: "Free cleaning supplies now available at the front desk",
        dorm: "Dorm IV",
        type: "announcement",
        posted_date: "2024-01-22",
        priority: "normal"
      }
    ];

    let alerts = JSON.parse(localStorage.getItem('avocado_alerts')) || defaultAlerts;

    const dormOptions = ["Dorm I", "Dorm II", "Dorm III", "Dorm IV", "Dorm V", "Dorm VI", "Dorm VII", "Dorm VIII", "Dorm IX", "Dorm X", "Dorm XI", "Dorm XII", "Dorm XIII", "Dorm XIV"];
    let userDorms = JSON.parse(localStorage.getItem('avocado_user_dorms')) || (currentUser ? [currentUser.dorm || "Dorm I"] : []);

    function renderAlerts() {
      const feed = document.getElementById('alerts-feed');
      if (!feed) return;

      const relevantAlerts = alerts.filter(a => userDorms.includes(a.dorm));

      if (relevantAlerts.length === 0) {
        feed.innerHTML = '<div style="padding: 40px; text-align: center;"><p class="text-muted">No alerts for your dorms. Subscribe to dorms to see alerts.</p></div>';
        return;
      }

      feed.innerHTML = relevantAlerts.map(alert => {
        const priorityColor = alert.priority === 'high' ? '#d32f2f' : '#558b2f';
        const typeEmoji = {
          maintenance: 'üîß',
          event: 'üéâ',
          alert: '‚ö†Ô∏è',
          announcement: 'üì¢'
        }[alert.type] || 'üìå';

        return `
          <div style="padding: 20px; border-bottom: 1px solid #e0d5cc;">
            <div style="display: flex; gap: 12px; align-items: start;">
              <div style="font-size: 28px;">${typeEmoji}</div>
              <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                  <h3 style="margin: 0; font-size: 16px;">${alert.title}</h3>
                  <span style="background-color: ${priorityColor}; color: white; padding: 2px 8px; border-radius: 3px; font-size: 11px; font-weight: 600;">
                    ${alert.priority.toUpperCase()}
                  </span>
                </div>
                <p style="color: #666; margin: 8px 0; font-size: 14px;">${alert.content}</p>
                <div style="display: flex; gap: 12px; font-size: 12px; color: #999;">
                  <span>üìç ${alert.dorm}</span>
                  <span>${formatDate(alert.posted_date)}</span>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderDormSubscriptions() {
      const subscDiv = document.getElementById('dorm-subscriptions');
      if (!subscDiv) return;

      subscDiv.innerHTML = dormOptions.map(dorm => {
        const isSubscribed = userDorms.includes(dorm);
        return `
          <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e0d5cc;">
            <span style="font-size: 14px;">${dorm}</span>
            <button class="btn ${isSubscribed ? 'btn-primary' : 'btn-secondary'}" 
                    onclick="toggleDormSubscription('${dorm}')"
                    style="padding: 6px 12px; font-size: 12px;">
              ${isSubscribed ? '‚úì Following' : 'Follow'}
            </button>
          </div>
        `;
      }).join('');
    }

    function toggleDormSubscription(dorm) {
      if (!currentUser) {
        openLoginModal();
        return;
      }

      if (userDorms.includes(dorm)) {
        userDorms = userDorms.filter(d => d !== dorm);
      } else {
        userDorms.push(dorm);
      }

      localStorage.setItem('avocado_user_dorms', JSON.stringify(userDorms));
      renderDormSubscriptions();
      renderAlerts();
      showAlert('success', 'Preferences updated!');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      renderAlerts();
      renderDormSubscriptions();
      updateUserUI();
    });
  </script>
</body>
</html>
